# Go言語
ここは、プログラミング言語のGo言語を勉強するための環境構築ファイルになる。  


<a name="algorithmHowToUseTheGoinstall"></a>
## Go言語用の開発環境構築
[Homebrew](https://brew.sh/index_ja)による構築を行う。  

事前にhomebrew自体のアップデートはしておくこと。
```terminal
$ brew upgrade
$
```
もしかして、このコマンドは、インストール済み全てにアップデートを掛ける？  
> [Upgrade everything with](https://docs.brew.sh/FAQ)  

あぁ・・・。  

<details><summary>オプションなしのアップグレードコマンド実施</summary>

```terminal
$ brew upgrade	←☆実施。
Updating Homebrew...
==> Auto-updated Homebrew!
Updated Homebrew from bfd605096 to 4e6919b73.
Updated 4 taps (homebrew/core, homebrew/cask, homebrew/cask-fonts and homebrew/services).
==> New Formulae
clickhouse-cpp            git-credential-libsecret  lastz                     lziprecover               viddy
cyral-gimme-db-token      gomodifytags              libavif                   neovim-qt
git-cliff                 gotests                   lunzip                    openssl@3
==> Updated Formulae
Updated 509 formulae.
==> Deleted Formulae
ocamlsdl
==> New Casks
almighty                  dockview                  firmaec                   rancher                   thetimemachinemechanic
cloudash                  dropbox-capture           jupyterlab                remarkable                tidelift
==> Updated Casks
Updated 296 casks.
==> Deleted Casks
font-ionicons                              microsoft-lync                             microsoft-r-open


==> Homebrew was updated to version 3.2.14
The changelog can be found at:
  https://github.com/Homebrew/brew/releases/tag/3.2.14
==> Upgrading 8 outdated packages:
pyenv 2.0.6 -> 2.0.7
vim HEAD-28e591d -> HEAD-28e591d
gmp 6.2.1 -> 6.2.1_1
gdbm 1.20 -> 1.21
harfbuzz 2.9.1 -> 3.0.0
ruby-build 20210825 -> 20210928
fribidi 1.0.10 -> 1.0.11
openjdk 16.0.2 -> 17
==> Downloading https://ghcr.io/v2/homebrew/core/openjdk/manifests/17
######################################################################## 100.0%
==> Downloading https://ghcr.io/v2/homebrew/core/openjdk/blobs/sha256:dbb4c5a7d6f6c465b88674417e5fd10ab807daeed7ce8f4617d66010d7c
==> Downloading from https://pkg-containers.githubusercontent.com/ghcr1/blobs/sha256:dbb4c5a7d6f6c465b88674417e5fd10ab807daeed7ce
######################################################################## 100.0%
==> Downloading https://ghcr.io/v2/homebrew/core/gdbm/manifests/1.21
######################################################################## 100.0%
==> Downloading https://ghcr.io/v2/homebrew/core/gdbm/blobs/sha256:a4e992de96a5f68d72c0d47da69cf70d5e3c315e15f8f77e0554a6758cadb8
==> Downloading from https://pkg-containers.githubusercontent.com/ghcr1/blobs/sha256:a4e992de96a5f68d72c0d47da69cf70d5e3c315e15f8
######################################################################## 100.0%
==> Downloading https://ghcr.io/v2/homebrew/core/gdbm/manifests/1.21
Already downloaded: /Users/asakunotomohiro/Library/Caches/Homebrew/downloads/0727ed9109e25bee50343875ea6f8d618e4e03806bbe25064904b0528119c6be--gdbm-1.21.bottle_manifest.json
==> Downloading https://ghcr.io/v2/homebrew/core/gdbm/blobs/sha256:a4e992de96a5f68d72c0d47da69cf70d5e3c315e15f8f77e0554a6758cadb8
Already downloaded: /Users/asakunotomohiro/Library/Caches/Homebrew/downloads/95a0492c50bc14ae8b8a5d919e5162ec755587251be856cc78ad93feca3ff312--gdbm--1.21.mojave.bottle.tar.gz
==> Cloning https://github.com/vim/vim.git
Updating /Users/asakunotomohiro/Library/Caches/Homebrew/vim--git
From https://github.com/vim/vim
   28e591dd5..be01090ef  master     -> origin/master
==> Checking out branch master
Already on 'master'
Your branch is behind 'origin/master' by 26 commits, and can be fast-forwarded.
  (use "git pull" to update your local branch)
HEAD is now at be01090ef patch 8.2.3458: not all dictdconf files are recognized
==> Downloading https://ghcr.io/v2/homebrew/core/gmp/manifests/6.2.1_1
######################################################################## 100.0%
==> Downloading https://ghcr.io/v2/homebrew/core/gmp/blobs/sha256:b9d7d36c8d263be0e02e17d435350546f9f7008eb21b6e86bf42f719efcba85
==> Downloading from https://pkg-containers.githubusercontent.com/ghcr1/blobs/sha256:b9d7d36c8d263be0e02e17d435350546f9f7008eb21b
######################################################################## 100.0%
==> Downloading https://ghcr.io/v2/homebrew/core/pyenv/manifests/2.0.7
######################################################################## 100.0%
==> Downloading https://ghcr.io/v2/homebrew/core/pyenv/blobs/sha256:cde37127f8c2179ff34ff2a888e7b95ad299e1139297c958cbc4bfb2b4d98
==> Downloading from https://pkg-containers.githubusercontent.com/ghcr1/blobs/sha256:cde37127f8c2179ff34ff2a888e7b95ad299e1139297
######################################################################## 100.0%
==> Downloading https://ghcr.io/v2/homebrew/core/ruby-build/manifests/20210928
######################################################################## 100.0%
==> Downloading https://ghcr.io/v2/homebrew/core/ruby-build/blobs/sha256:714368bfdc8e6fca4579a8fc3c1781b3f051033505f3968b9de42727
==> Downloading from https://pkg-containers.githubusercontent.com/ghcr1/blobs/sha256:714368bfdc8e6fca4579a8fc3c1781b3f051033505f3
######################################################################## 100.0%
==> Downloading https://ghcr.io/v2/homebrew/core/fribidi/manifests/1.0.11
######################################################################## 100.0%
==> Downloading https://ghcr.io/v2/homebrew/core/fribidi/blobs/sha256:3ef3b5f32b31fad3fb8dc39a559b24abb04cf46c9b29303285eb160d1f4
==> Downloading from https://pkg-containers.githubusercontent.com/ghcr1/blobs/sha256:3ef3b5f32b31fad3fb8dc39a559b24abb04cf46c9b29
######################################################################## 100.0%
==> Downloading https://ghcr.io/v2/homebrew/core/gdbm/manifests/1.21
Already downloaded: /Users/asakunotomohiro/Library/Caches/Homebrew/downloads/0727ed9109e25bee50343875ea6f8d618e4e03806bbe25064904b0528119c6be--gdbm-1.21.bottle_manifest.json
==> Downloading https://ghcr.io/v2/homebrew/core/gdbm/blobs/sha256:a4e992de96a5f68d72c0d47da69cf70d5e3c315e15f8f77e0554a6758cadb8
Already downloaded: /Users/asakunotomohiro/Library/Caches/Homebrew/downloads/95a0492c50bc14ae8b8a5d919e5162ec755587251be856cc78ad93feca3ff312--gdbm--1.21.mojave.bottle.tar.gz
==> Downloading https://ghcr.io/v2/homebrew/core/harfbuzz/manifests/3.0.0
######################################################################## 100.0%
==> Downloading https://ghcr.io/v2/homebrew/core/harfbuzz/blobs/sha256:182656856f737a6d2836f5754f986757b8be9f90a6befb637c6da12655
==> Downloading from https://pkg-containers.githubusercontent.com/ghcr1/blobs/sha256:182656856f737a6d2836f5754f986757b8be9f90a6be
######################################################################## 100.0%
==> Upgrading openjdk
  16.0.2 -> 17

==> Pouring openjdk--17.mojave.bottle.tar.gz
==> Caveats
For the system Java wrappers to find this JDK, symlink it with
  sudo ln -sfn /usr/local/opt/openjdk/libexec/openjdk.jdk /Library/Java/JavaVirtualMachines/openjdk.jdk

openjdk is keg-only, which means it was not symlinked into /usr/local,
because macOS provides similar software and installing this software in
parallel can cause all kinds of trouble.

If you need to have openjdk first in your PATH, run:
  echo 'export PATH="/usr/local/opt/openjdk/bin:$PATH"' >> /Users/asakunotomohiro/.bash_profile

For compilers to find openjdk you may need to set:
  export CPPFLAGS="-I/usr/local/opt/openjdk/include"

==> Summary
🍺  /usr/local/Cellar/openjdk/17: 639 files, 304.0MB
Removing: /usr/local/Cellar/openjdk/16.0.2... (646 files, 329.0MB)
Removing: /Users/asakunotomohiro/Library/Caches/Homebrew/openjdk--16.0.2... (192.8MB)
==> Upgrading gdbm
  1.20 -> 1.21 

==> Pouring gdbm--1.21.mojave.bottle.tar.gz
🍺  /usr/local/Cellar/gdbm/1.21: 24 files, 736.5KB
Removing: /usr/local/Cellar/gdbm/1.20... (24 files, 662.3KB)
Removing: /Users/asakunotomohiro/Library/Caches/Homebrew/gdbm--1.20... (212.6KB)
==> Upgrading vim
  HEAD-28e591d -> HEAD-be01090 

Warning: Your Xcode (11.3) is outdated.
Please update to Xcode 11.3.1 (or delete it).
Xcode can be updated from the App Store.

Warning: A newer Command Line Tools release is available.
Update them from Software Update in System Preferences or run:
  softwareupdate --all --install --force

If that doesn't show you any updates, run:
  sudo rm -rf /Library/Developer/CommandLineTools
  sudo xcode-select --install

Alternatively, manually download them from:
  https://developer.apple.com/download/more/.
You should download the Command Line Tools for Xcode 11.3.1.

==> ./configure --prefix=/usr/local --mandir=/usr/local/Cellar/vim/HEAD-be01090/share/man --enable-multibyte --with-tlib=ncurses 
==> make
==> make install prefix=/usr/local/Cellar/vim/HEAD-be01090 STRIP=/usr/bin/true
🍺  /usr/local/Cellar/vim/HEAD-be01090: 2,006 files, 34.2MB, built in 5 minutes 30 seconds
Removing: /usr/local/Cellar/vim/HEAD-28e591d... (2,006 files, 34.2MB)
==> Upgrading gmp
  6.2.1 -> 6.2.1_1 

==> Pouring gmp--6.2.1_1.mojave.bottle.tar.gz
🍺  /usr/local/Cellar/gmp/6.2.1_1: 21 files, 3.2MB
Removing: /usr/local/Cellar/gmp/6.2.1... (21 files, 3.2MB)
==> Upgrading pyenv
  2.0.6 -> 2.0.7 

==> Pouring pyenv--2.0.7.mojave.bottle.tar.gz
🍺  /usr/local/Cellar/pyenv/2.0.7: 807 files, 2.7MB
Removing: /usr/local/Cellar/pyenv/2.0.6... (773 files, 2.6MB)
Removing: /Users/asakunotomohiro/Library/Caches/Homebrew/pyenv--2.0.6... (635KB)
==> Upgrading ruby-build
  20210825 -> 20210928 

==> Pouring ruby-build--20210928.all.bottle.tar.gz
🍺  /usr/local/Cellar/ruby-build/20210928: 542 files, 271.3KB
Removing: /usr/local/Cellar/ruby-build/20210825... (540 files, 270.6KB)
Removing: /Users/asakunotomohiro/Library/Caches/Homebrew/ruby-build--20210825... (55.9KB)
==> Upgrading fribidi
  1.0.10 -> 1.0.11 

==> Pouring fribidi--1.0.11.mojave.bottle.tar.gz
🍺  /usr/local/Cellar/fribidi/1.0.11: 67 files, 461.2KB
Removing: /usr/local/Cellar/fribidi/1.0.10... (67 files, 600.7KB)
==> Upgrading harfbuzz
  2.9.1 -> 3.0.0 

==> Pouring harfbuzz--3.0.0.mojave.bottle.tar.gz
🍺  /usr/local/Cellar/harfbuzz/3.0.0: 68 files, 6.8MB
Removing: /usr/local/Cellar/harfbuzz/2.9.1... (68 files, 6.7MB)
Removing: /Users/asakunotomohiro/Library/Caches/Homebrew/harfbuzz--2.9.1... (2.1MB)
==> No outdated dependents to upgrade!
==> Checking for dependents of upgraded formulae...
==> Reinstalling 1 broken dependent from source:
avr-gcc@7
==> Downloading https://download.savannah.gnu.org/releases/avr-libc/avr-libc-2.0.0.tar.bz2
Already downloaded: /Users/asakunotomohiro/Library/Caches/Homebrew/downloads/02c166efff9cac7ac9108da0a404d5ab73732ab0d785909ed7bc76e2e6b953da--avr-libc-2.0.0.tar.bz2
==> Downloading https://ftp.gnu.org/gnu/gcc/gcc-7.5.0/gcc-7.5.0.tar.xz
Already downloaded: /Users/asakunotomohiro/Library/Caches/Homebrew/downloads/5df6f0d517751ba721e737b7acba5981a2c1c4dea76abd235b90205e69463e5b--gcc-7.5.0.tar.xz
==> Reinstalling avr-gcc@7 
Warning: Your Xcode (11.3) is outdated.
Please update to Xcode 11.3.1 (or delete it).
Xcode can be updated from the App Store.

Warning: A newer Command Line Tools release is available.
Update them from Software Update in System Preferences or run:
  softwareupdate --all --install --force

If that doesn't show you any updates, run:
  sudo rm -rf /Library/Developer/CommandLineTools
  sudo xcode-select --install

Alternatively, manually download them from:
  https://developer.apple.com/download/more/.
You should download the Command Line Tools for Xcode 11.3.1.

Error: An exception occurred within a child process:
  FormulaUnavailableError: No available formula with the name "/usr/local/opt/avr-gcc@7/.brew/avr-gcc@7.rb".
$ echo $?	←☆アップグレードがエラー終了。
1
$ brew update
Updated 1 tap (homebrew/core).
==> Updated Formulae
solidity
$ echo $?
0
$
```
最後エラーになっているのだが・・・どういうこと!?  

しかも、[pyenv](../Python言語/環境構築.md)を使わないようにしたため、削除したはずだが・・・[pyenv](https://docs.python.org/ja/3/library/venv.html)は残したままだったか・・・。  

</details>

以下、Go言語のインストールを行う。
```terminal
$ go version	←☆自前(手動)で入れた環境のはず。
go version go1.15.2 darwin/amd64
$ brew upgrade go	←☆ホームブリュで管理されていない。
Error: go not installed
$ brew install go	←☆新規インストール。
==> Downloading https://ghcr.io/v2/homebrew/core/go/manifests/1.17
######################################################################## 100.0%
==> Downloading https://ghcr.io/v2/homebrew/core/go/blobs/sha256:31a55e8c57f194a5f6d44b9968582a5f4e65ccd3b533d1c323b6d2a7c4682
==> Downloading from https://pkg-containers.githubusercontent.com/ghcr1/blobs/sha256:31a55e8c57f194a5f6d44b9968582a5f4e65ccd3b
######################################################################## 100.0%
==> Pouring go--1.17.mojave.bottle.tar.gz
🍺  /usr/local/Cellar/go/1.17: 10,809 files, 565.6MB
$ go version	←☆ターミナルの再起動が必要。
go version go1.15.2 darwin/amd64
$ go version	←☆最新版が導入された。
go version go1.17 darwin/amd64
$
```

## 虚弱性
定期的に最新版の動向を確認しなければ、虚弱性を保持したまま使うことになり、技術者として失格行動を取ってしまう。  

以下、Twitterの[Goアカウント連絡](https://twitter.com/golang/status/1436062542166646792)
> 🥳 Go 1.17.1 and 1.16.8 are released!  
>
> 🔐 Security: Includes a security fix for archive/zip (CVE-2021-39293).  
>
> 📢 Announcement: https://groups.google.com/g/golang-announce/c/dx9d7IOseHw…  
>
> 📦 Download: https://golang.org/dl/#go1.17.1  

われらが[mattn](https://mattn.kaoriya.net)さんの[Twitter](https://twitter.com/mattn_jp/status/1436930279847780354)でも警告を出してくれている。
> そういえば Go.1.17.1 出てるので更新してね。archive/zip 周りで OOM 起こせる脆弱性見つかってるので。  

残念ながら[OOM](https://docs.oracle.com/cd/E19205-01/821-0384/blajb/index.html)が何か知らないけど。  

その[mattn](https://twitter.com/mattn_jp/status/1442439569354280960)さんは、Githubから盾を受け取ったそうだ。  
> #GitHub 社からなんか凄いのきた。  
> [なんだか海外から凄い荷物届いた。](https://twitter.com/mattn_jp/status/1440289873294811141)  

私も頑張って盾をもらえるように頑張ろう。  


## おまけ
[`brew install goenv`](https://github.com/syndbg/goenv)もあるようだ。  
これは、[perlbrew](https://perldoc.jp/docs/modules/App-perlbrew-0.10/bin/perlbrew.pod)や[pyenv](https://github.com/pyenv/pyenv)のようなものなのだろう。  
[pyvenv](https://docs.python.org/ja/3/library/venv.html)の事例があるとおり、仮想環境は遠慮しておこう(で、pyenvの話はどこいった？)。  


以上。
<!-- vim: set ts=4 sts=4 sw=4 tw=0 ff=unix fenc=utf-8 ft=markdown expandtab: -->
